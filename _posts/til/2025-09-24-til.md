---
title: "[250924] TIL"
excerpt: ""

categories:
  - TIL
tags:
  - [TIL]

permalink: /blog/til/250924

toc: true
toc_sticky: true

date: 2025-09-24
last_modified_at: 2025-09-24
---

# Today I Learned (2025-09-24)

# 모노레포 + Amplify 브랜치 자동배포

# 고민

그럼 이제 다른 질문인데 모노레포로 개발
두 개의 앱이 있고 cms, admin 가 있음

admin은 이제 신규로 개발할꺼고 cms는 유지보수 정도만 하고 있음
cms는 dev, stage, prod 로 구성되어있고
admin도 마찬가지로 dev, stage, prod로 구성함

AWS Amplify 로 배포하고 dev,stage,prod 브랜치 push 시 자동 빌드 & 배포
그러다보니 admin 수정사항을 dev에서 push해도 cms도 다시 빌드되는게 불필요한 행위라고 생각이 들어서  
이걸 개선 시키는 방법 없을까?

그렇다고 브랜치 앱 별로 따로 파서 사용하기엔 같은 레포에서 관리해서 관리가 편해진다는 모노레포의 장점이 사라지는 것 같고 cms/dev,cms/stage,cms/prod admin/dev,admin/stage,admin/prod 이러면 6개의 브랜치를 관리해야하는게 더 복잡해지는 것 같음

# 해결책

dev, stage, admin 한 개씩 두고
Amplify 에서 모노레포 설정과 환경 변수를 두면, 빌드 시작하기 전에 코드 반영 사항을 점검하고 변한게 없으면 빌드를 안함

https://docs.aws.amazon.com/ko_kr/amplify/latest/userguide/monorepo-configuration.html#turborepo-pnpm-monorepo-configuration

터보레포와 pnpm 같은 경우 .npmrc 파일에 링커 하지 않으면 빌드 오류 발생

vite 프로젝트는 이거와 별개로

```
 - printenv | grep '^VITE_' | sort > apps/cms/.env.production
```

위와 같은 명령어로 환경 변수 넣어줌
뭔가 Nextjs 도 추후에 필요하지 않을까 싶음
