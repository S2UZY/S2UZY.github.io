---
title: "[250321] TIL"
excerpt: "Vanilla JSë¡œ Virtual domì„ êµ¬í˜„í•œë‹¤ë©´ ê³ ë ¤í•´ì•¼í•  ë‚´ìš©"

categories:
  - TIL
tags:
  - [TIL]

permalink: /blog/til/250321

toc: true
toc_sticky: true

date: 2025-03-21
last_modified_at: 2025-03-21
---


# ì˜¤ëŠ˜ í•œ ì¼
# Virtual DOM ì´ë€?

- ì‹¤ì œ DOM ì„ ì¶”ìƒí™”í•œ ê°œë…
- ë©”ëª¨ë¦¬ ë‚´ì— ê°€ìƒìœ¼ë¡œ ì¡´ì¬í•˜ëŠ” DOMì„ ì˜ë¯¸
- ì‹¤ì œ DOM ì— ë³€í™”ëŠ” ë¦¬í”Œë ˆì´ ë¦¬í”„ì—”íŠ¸ì— ëŒ€í•œ ë¹„ìš©ì´ ë§ì´ ë°œìƒí•¨
- ë²„ì¸„ì–¼ ë”ì— ë¨¼ì € ë³€í™”ë¥¼ ì²˜ë¦¬í•˜ê³ , ì´ ë³€ê²½ ì‚¬í•­ì„ ì ìš©í•˜ê¸° ì „ì— ì´ì „ ë²„ì¸„ì–¼ ë”ê³¼ ë¹„êµí•˜ì—¬ í•„ìš”í•œ ë¶€ë¶„ë§Œ ì°¾ì•„ë‚´ ì‹¤ì œ DOM ì— ì ìš©í•¨ ( Diffing, Reconciliation )

## ë¦¬ì•¡íŠ¸ì—ì„œ Virtual DOM

- ë¦¬ì•¡íŠ¸ì—ì„œ í•µì‹¬ ê¸°ëŠ¥ ì¤‘ í•˜ë‚˜ì„
- ë¦¬ì•¡íŠ¸ëŠ” ë Œë”ë§ì´ ë°œìƒë  ìƒí™©ì— ë†“ì´ê²Œ ë˜ë©´ ìƒˆë¡œìš´ í™”ë©´ì— ë“¤ì–´ê°ˆ ë‚´ìš©ì´ ë‹´ê¸´ ê°€ìƒ ë”ì„ ìƒì„±
- ë¦¬ì•¡íŠ¸ëŠ” ì´ì „ í™”ë©´ êµ¬ì¡°ì™€ ë Œë”ë§ ì´í›„ í™”ë©´ êµ¬ì¡° 2ê°œì˜ ê°€ìƒ ë” ê°ì²´ ìœ ì§€

## diffing ì•Œê³ ë¦¬ì¦˜ ë™ì‘ ë°©ì‹

1. ì´ì „ ê°€ìƒë” íŠ¸ë¦¬ì™€ ìƒˆë¡œìš´ ê°€ìƒë” íŠ¸ë¦¬ë¥¼ ë¹„êµí•˜ê³  ë£¨íŠ¸ ë…¸ë“œì—ì„œ ì‹œì‘í•´ì„œ ì´ì „ê³¼ ìƒˆë¡œìš´ ë…¸ë“œë¥¼ ë¹„êµ
2. ë‘ ë…¸ë“œê°€ ë‹¤ë¥¸ ìœ í˜•ì´ë©´ ìƒˆ ë…¸ë“œë¥¼ ìƒì„±í•˜ì—¬ ê¸°ì¡´ ë…¸ë“œë¥¼ ëŒ€ì²´
3. ë‘ ë…¸ë“œê°€ ê°™ì€ ìœ í˜•ì´ë©´ ì†ì„±ì„ ë¹„êµí•´ì„œ ë³€ê²½ëœ ê²ƒì´ ìˆëŠ”ì§€ í™•ì¸í•¨
    1. ë³€ê²½ ëœ ì†ì„±ì´ ìˆìœ¼ë©´ ì†ì„± ì—…ë°ì´íŠ¸
    2. ë³€ê²½ ëœ ì†ì„±ì´ ì—†ìœ¼ë©´ ê·¸ëŒ€ë¡œ ì‚¬ìš©
4. ë¦¬ìŠ¤íŠ¸ í•­ëª©ì˜ ê²½ìš° keyë¥¼ ì‚¬ìš©í•´ì„œ íš¨ìœ¨ì ìœ¼ë¡œ ë¹„êµs
5. ìì‹ë…¸ë“œë¥¼ ì¬ê·€ì ìœ¼ë¡œ ë¹„êµ

## **Reconciliation ë‹¨ê³„ (ì¬ì¡°ì •)**

- diffing ì•Œê³ ë¦¬ì¦˜ì„ í¬í•¨í•œ ë” ë„“ì€ ê°œë…
- Virtual DOMì˜ ë³€ê²½ì‚¬í•­ì„ ì‹¤ì œ DOMì— íš¨ìœ¨ì ìœ¼ë¡œ ì ìš©í•˜ëŠ” ì „ì²´ í”„ë¡œì„¸ìŠ¤ë¥¼ ì˜ë¯¸
- Diffingì—ì„œ ì‹ë³„ëœ ë³€ê²½ì‚¬í•­ì„ ë°”íƒ•ìœ¼ë¡œ ì‹¤ì œ DOM ì—…ë°ì´íŠ¸ ê³„íšì„ ìˆ˜ë¦½
- ë³€ê²½ì‚¬í•­ì„ ë°°ì¹˜(batch)ë¡œ ê·¸ë£¹í™”í•˜ì—¬ ì²˜ë¦¬
- ì‹¤ì œ DOM ì—…ë°ì´íŠ¸ë¥¼ ìµœì í™”í•˜ì—¬ ìˆ˜í–‰
- ì»´í¬ë„ŒíŠ¸ ìƒëª…ì£¼ê¸° ë©”ì„œë“œë¥¼ ì ì ˆí•œ ì‹œì ì— í˜¸ì¶œ
- ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì¬ì„¤ì •

# Vanilla JS ë¡œ Virtual DOM êµ¬í˜„ ì‹œ ê³ ë ¤ì‚¬í•­

## 1. DOM í‘œí˜„ êµ¬ì¡° ì„¤ê³„

- ë…¸ë“œ í‘œí˜„ ë°©ì‹
    - ê° DOM ë…¸ë“œë¥¼ JS ê°ì²´ë¡œ í‘œí˜„í•˜ëŠ” ë°©ë²• ì„¤ê³„
- ì†ì„± ë° ì´ë²¤íŠ¸ ì²˜ë¦¬
    - ìš”ì†Œì˜ ì†ì„±, ìŠ¤íƒ€ì¼, ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ì„ ì–´ë–»ê²Œ í‘œí˜„í• ì§€ ê²°ì •
- í…ìŠ¤íŠ¸ ë…¸ë“œ ì²˜ë¦¬
    - í…ìŠ¤íŠ¸ ë…¸ë“œë¥¼ ì–´ë–»ê²Œ í‘œí˜„í• ì§€ ê²°ì •

```jsx
// ê°€ìƒ DOM ë…¸ë“œ ì˜ˆì‹œ
{
  type: 'div',
  props: {
    id: 'container',
    className: 'wrapper',
    onClick: () => console.log('clicked')
  },
  children: [
    { type: 'h1', props: {}, children: ['ì œëª©'] },
    { type: 'p', props: {}, children: ['ë‚´ìš©'] }
  ]
}
```

## 2. Reconciliation ì•Œê³ ë¦¬ì¦˜

- ì°¨ì´ì  ê°ì§€ ( Diffing )
    - ì´ì „ ê°€ìƒ DOMê³¼ ìƒˆ ê°€ìƒ DOM ê°„ì˜ ì°¨ì´ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì°¾ëŠ” ì•Œê³ ë¦¬ì¦˜ êµ¬í˜„
- í‚¤ (Key) ê´€ë¦¬
    - ë¦¬ìŠ¤íŠ¸ í•­ëª©ì˜ íš¨ìœ¨ì ì¸ ì¬ì‚¬ìš©ê³¼ ì¬ì •ë ¬ì„ ìœ„í•œ ê³ ìœ  ì‹ë³„ì ê´€ë¦¬
- íŠ¸ë¦¬ ë¹„êµ ìµœì í™”
    - ì „ì²´ íŠ¸ë¦¬ë¥¼ ë¹„êµí•˜ëŠ” ëŒ€ì‹  ë³€ê²½ ê°€ëŠ¥ì„±ì´ ìˆëŠ” ë¶€ë¶„ë§Œ ë¹„êµí•˜ëŠ” ì „ëµ

## 3. DOM ì—…ë°ì´íŠ¸ ìµœì í™”

- ìµœì†Œ ì¡°ì‘ : í•„ìš”í•œ DOM ì¡°ì‘ì„ ìµœì†Œí™”í•˜ëŠ” ë°©ë²•
- ë°°ì¹˜ ì²˜ë¦¬ : ì—¬ëŸ¬ DOM ì—…ë°ì´íŠ¸ë¥¼ ê·¸ë£¹í™”í•˜ì—¬ í•œ ë²ˆì— ì²˜ë¦¬
- ë¹„ë™ê¸° ì—…ë°ì´íŠ¸ : ë Œë”ë§ ì„±ëŠ¥ì„ ìœ„í•´ DOM ì—…ë°ì´íŠ¸ë¥¼ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬

## 4. ì»´í¬ë„ŒíŠ¸ ì‹œìŠ¤í…œ ì„¤ê³„

- ì»´í¬ë„ŒíŠ¸ ìƒëª…ì£¼ê¸° : ë§ˆìš´íŠ¸, ì—…ë°ì´íŠ¸, ì–¸ë§ˆìš´íŠ¸ ë“±ì˜ ìƒëª…ì£¼ê¸° ì´ë²¤íŠ¸ ê´€ë¦¬
- ìƒíƒœ ê´€ë¦¬ : ì»´í¬ë„ŒíŠ¸ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ê³  ë³€ê²½ ì‹œ ë¦¬ë Œë”ë§ íŠ¸ë¦¬ê±° ë°©ë²•
- ì†ì„± (Props) ì „ë‹¬ : ë¶€ëª¨ì—ì„œ ìì‹ ì»´í¬ë„ŒíŠ¸ë¡œ ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ëŠ” ë§¤ì»¤ë‹ˆì¦˜

## 5. ì´ë²¤íŠ¸ ì²˜ë¦¬

- ì´ë²¤íŠ¸ ìœ„ì„ ( Event Delegation ) : íš¨ìœ¨ì ì¸ ì´ë²¤íŠ¸ ì²˜ë¦¬ë¥¼ ìœ„í•œ ì´ë²¤íŠ¸ ìœ„ì„ êµ¬í˜„
    - ì—¬ëŸ¬ ìš”ì†Œì— ê°ê° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ë¶™ì´ëŠ” ëŒ€ì‹ , ê³µí†µ ë¶€ëª¨ ìš”ì†Œì— í•˜ë‚˜ì˜ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ë¶™ì´ëŠ” ê¸°ë²•
    - ì´ë²¤íŠ¸ê°€ ë²„ë¸”ë§ë˜ëŠ” íŠ¹ì„±ì„ í™œìš©í•œ íŒ¨í„´
        - ë²„ë¸”ë§ : DOM íŠ¸ë¦¬ë¥¼ íƒ€ê³  ìœ„ë¡œ ì˜¬ë¼ê°€ëŠ” ì´ë²¤íŠ¸ ë²„ë¸”ë§
    
    ```jsx
    // ğŸš« ì´ë²¤íŠ¸ ìœ„ì„ ì—†ì´ - ê° ë²„íŠ¼ë§ˆë‹¤ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
    document.querySelectorAll('.button').forEach(button => {
      button.addEventListener('click', function() {
        console.log('ë²„íŠ¼ í´ë¦­ë¨:', this.textContent);
      });
    });
    
    // âœ… ì´ë²¤íŠ¸ ìœ„ì„ ì‚¬ìš© - ë¶€ëª¨ ìš”ì†Œì— í•˜ë‚˜ì˜ ë¦¬ìŠ¤ë„ˆë§Œ ì¶”ê°€
    document.querySelector('.button-container').addEventListener('click', function(e) {
      // í´ë¦­ëœ ìš”ì†Œê°€ ë²„íŠ¼ì¸ì§€ í™•ì¸
      if (e.target.classList.contains('button')) {
        console.log('ë²„íŠ¼ í´ë¦­ë¨:', e.target.textContent);
      }
    });
    ```
    
- í•©ì„± ì´ë²¤íŠ¸ ( Synthetic Events ) : ë¸Œë¼ìš°ì € ê°„ ì¼ê´€ëœ ì´ë²¤íŠ¸ ì²˜ë¦¬ë¥¼ ìœ„í•œ ì´ë²¤íŠ¸ ë˜í¼

## 6. ì„±ëŠ¥ ê³ ë ¤ì‚¬í•­

- ë©”ëª¨ë¦¬ ê´€ë¦¬ : ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ê³¼ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€
- ë Œë”ë§ ìµœì í™” : ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ ë°©ì§€
- í° ë¦¬ìŠ¤íŠ¸ ì²˜ë¦¬ : ëŒ€ëŸ‰ì˜ ë°ì´í„°ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ë Œë”ë§í•˜ëŠ” ë°©ë²•

```jsx
// ê°€ìƒ DOM ë…¸ë“œ ìƒì„± í•¨ìˆ˜
function createElement(type, props, ...children) {
  return {
    type,
    props: props || {},
    children: children.flat().map(child => 
      typeof child === 'string' || typeof child === 'number'
        ? { type: 'TEXT_ELEMENT', props: { nodeValue: child } }
        : child
    )
  };
}

// DOM ë…¸ë“œ ìƒì„± í•¨ìˆ˜
function createDomNode(vNode) {
  if (vNode.type === 'TEXT_ELEMENT') {
    return document.createTextNode(vNode.props.nodeValue);
  }
  
  const domNode = document.createElement(vNode.type);
  
  // ì†ì„± ì„¤ì •
  Object.keys(vNode.props)
    .filter(key => key !== 'children')
    .forEach(name => {
      if (name.startsWith('on')) {
        const eventType = name.toLowerCase().substring(2);
        domNode.addEventListener(eventType, vNode.props[name]);
      } else {
        domNode[name] = vNode.props[name];
      }
    });
  
  // ìì‹ ë…¸ë“œ ì²˜ë¦¬
  vNode.children.forEach(childVNode => {
    domNode.appendChild(createDomNode(childVNode));
  });
  
  return domNode;
}

// ì°¨ì´ì  ë¹„êµ ë° DOM ì—…ë°ì´íŠ¸ í•¨ìˆ˜
function updateDom(dom, oldVNode, newVNode) {
  // êµ¬í˜„ ìƒëµ - ì†ì„± ë¹„êµ ë° ì—…ë°ì´íŠ¸ ë¡œì§
  // ìì‹ ë…¸ë“œ ë¹„êµ ë° ì—…ë°ì´íŠ¸ ë¡œì§
}

// ë Œë”ë§ í•¨ìˆ˜
function render(vNode, container) {
  // ì´ˆê¸° ë Œë”ë§ ë˜ëŠ” ì—…ë°ì´íŠ¸ ë¡œì§
  container.innerHTML = '';
  container.appendChild(createDomNode(vNode));
}
```

[ì¬ì¡°ì • (Reconciliation) â€“ React](https://ko.legacy.reactjs.org/docs/reconciliation.html)

[Preserving and Resetting State â€“ React](https://react.dev/learn/preserving-and-resetting-state)